# nabla-servers-bower-sample
![nabla-servers-bower-sample](http://home.nabla.mobi:7075/images/mroizo.1f00120c.png)

[![License](http://img.shields.io/:license-apache-blue.svg?style=flat-square)](http://www.apache.org/licenses/LICENSE-2.0.html)
[![Gitter](https://badges.gitter.im/nabla-servers-bower-sample/Lobby.svg)](https://gitter.im/nabla-servers-bower-sample/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge)

Javascript project

## Overview

![](https://raw.githubusercontent.com/AlbanAndrieu/nabla-servers-bower-sample/master/screenshot-overview.png)

## Build

[![Grunt](https://gruntjs.com/cdn/builtwith.png)](http://gruntjs.com/)
[![Travis Build Status](https://travis-ci.org/AlbanAndrieu/nabla-servers-bower-sample.svg?branch=master)](https://travis-ci.org/AlbanAndrieu/nabla-servers-bower-sample)
[![Jenkins Build Status](http://home.nabla.mobi:8381/job/nabla-servers-bower-sample-nightly/badge/icon)](http://home.nabla.mobi:8381/job/nabla-servers-bower-sample-nightly)
[![Jenkins tests](https://img.shields.io/jenkins/t/https/jenkins.qa.ubuntu.com/view/Precise/view/All%20Precise/job/precise-desktop-amd64_default.svg)]()

## Quality
[![Quality Gate](https://sonarcloud.io/api/project_badges/measure?project=com.nabla.project.servers.sample%3Abower-sample%3Amaster&metric=alert_status)](https://sonarcloud.io/dashboard?id=com.nabla.project.servers.sample%3Abower-sample)
[![SonarQube Coverage](https://img.shields.io/sonar/http/sonar.qatools.ru/ru.yandex.qatools.allure:allure-core/coverage.svg)]()
[![SonarQube Tech Debt](https://img.shields.io/sonar/http/sonar.qatools.ru/ru.yandex.qatools.allure:allure-core/tech_debt.svg)]()

[![Dependency Status](https://img.shields.io/david/AlbanAndrieu/nabla-servers-bower-sample.svg?style=flat-square)](https://david-dm.org/AlbanAndrieu/nabla-servers-bower-sample)
[![devDependency Status](https://img.shields.io/david/dev/AlbanAndrieu/nabla-servers-bower-sample.svg?style=flat-square)](https://david-dm.org/AlbanAndrieu/nabla-servers-bower-sample#info=devDependencies)
[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg?style=flat-square)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample)

[![Code Climate](https://codeclimate.com/github/AlbanAndrieu/nabla-servers-bower-sample/badges/gpa.svg)](https://codeclimate.com/github/AlbanAndrieu/nabla-servers-bower-sample)
[![Test Coverage](https://codeclimate.com/github/AlbanAndrieu/nabla-servers-bower-sample/badges/coverage.svg)](https://codeclimate.com/github/AlbanAndrieu/nabla-servers-bower-sample/coverage)
[![Known Vulnerabilities](https://snyk.io/test/github/albanandrieu/nabla-servers-bower-sample/badge.svg)](https://snyk.io/test/github/albanandrieu/nabla-servers-bower-sample)
[![NSP Status](https://nodesecurity.io/orgs/nabla/projects/09223c07-0122-47bd-ab24-f0a4b6b6a38a/badge)](https://nodesecurity.io/orgs/nabla/projects/09223c07-0122-47bd-ab24-f0a4b6b6a38a)

## Info

[![Minimal java version](https://img.shields.io/badge/java-1.8-yellow.svg)](https://img.shields.io/badge/java-1.8-yellow.svg)
[![Node version](https://img.shields.io/node/v/[NPM-MODULE-NAME].svg?style=flat)](http://nodejs.org/download/)

[![Branch](http://img.shields.io/github/tag/AlbanAndrieu/nabla-servers-bower-sample.svg?style=flat-square)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/tree/master)
[![Platforms](http://img.shields.io/badge/platforms-ubuntu-lightgrey.svg?style=flat)](#)

[![Last deployed](https://img.shields.io/github/last-commit/AlbanAndrieu/nabla-servers-bower-sample/gh-pages.svg?label=last%20deployed)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/commits/gh-pages)

## Tools

[![social-likes-next](https://data.jsdelivr.com/v1/package/npm/social-likes-next/badge)](https://www.jsdelivr.com/package/npm/social-likes-next)

## Contributing [![contributions welcome](https://img.shields.io/badge/contributions-welcome-brightgreen.svg?style=flat)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/issues) [![Requirements](https://requires.io/github/pycontribs/jira/requirements.svg?branch=master)](https://requires.io/github/nabla-servers-bower-sample/jira/requirements/?branch=master) [![Donate](https://img.shields.io/gratipay/AlbanAndrieu.svg?style=flat)](https://www.gratipay.com/~AlbanAndrieu) [![bounties](https://img.shields.io/bountysource/team/pycontribs/activity.svg)](https://www.bountysource.com/teams/nabla-servers-bower-sample/issues?tracker_ids=3650997)

[![GitHub issues by-label](https://img.shields.io/github/issues/AlbanAndrieu/nabla-servers-bower-sample/good%20first%20issue.svg)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22)
[![GitHub pull requests by-label](https://img.shields.io/github/issues-pr/AlbanAndrieu/nabla-servers-bower-sample/good%20first%20issue.svg)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/pulls?q=is%3Apr+is%3Aopen+label%3A%22good+first+issue%22)

[![Maintainers Wanted](https://img.shields.io/badge/maintainers-wanted-red.svg)](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/)

## Why? [![start with why](https://img.shields.io/badge/start%20with-why%3F-brightgreen.svg?style=flat)](http://www.ted.com/talks/simon_sinek_how_great_leaders_inspire_action)

<!--
[![Grunt](https://cdn.gruntjs.com/builtwith.png)](http://gruntjs.com/)
[![Flattr this git repo](http://api.flattr.com/button/flattr-badge-large.png)](https://flattr.com/submit/auto?user_id=AlbanAndrieu&url=https://github.com/AlbanAndrieu/nabla-servers-bower-sample&title=nabla-servers-bower-sample&language=en_GB&tags=github&category=software)
[![Inline docs](http://inch-ci.org/github/{ORG-or-USERNAME}/{REPO-NAME}.svg?branch=master)](http://inch-ci.org/github/{ORG-or-USERNAME}/{REPO-NAME})
[![Xing](http://www.xing.com/img/buttons/45_fr_btn.gif)](http://www.xing.com/profile/Alban_Andrieu)
-->
[![Website](https://img.shields.io/website-up-down-green-red/http/shields.io.svg?label=nabla)](http://alban-andrieu.com)

A bower project sample.
=============

This project is generated with [yo angular generator](https://github.com/yeoman/generator-angular) version 0.11.1.
Then I applied [uncss generator](https://github.com/addyosmani/generator-webapp-uncss)

This project is also used to test integration of build tools like:

 * private-bower (bower repo and caching)
 * nexus (npm and java packages repo and caching)
 * jenkins (continuous delivery in a jetty embedded)
 * sonar multi-languages and coverage (QA metrics except JIRA and perf metrics)
 * yeoman/nodejs/npm/grunt/bower and maven integration
 * zaproxy (security tests), checkmarx, dependency-check and nsp (thirdparty security check)
 * performance (jmx, phantomas, pagespeed, webpagetest, yslow, junitperf in jenkins)
 * sonar / stash / jira / jenkins /git /checkmarx integration

languages like :

 * javascript
	* unit tests (karma) + LCOV coverage
	* end2end tests (protractor)
 * java
	* unit tests (junit and jmockit) + Jacoco coverage
	* integration tests (junit) + Jacoco coverage
 * groovy
	* unit tests (junit) + Jacoco coverage
	* integration tests (junit) + Jacoco coverage

jmeter, gatling, mutation testing and arquillian are available in other sample project

## Create project

as local user
```
#npm install generator-angular
#npm install generator-angular-fullstack
yarn config set "strict-ssl" false -g
#yarn config set cafile ~/NABLA.crt
set NODE_TLS_REJECT_UNAUTHORIZED=0
yarn install

```
as local user
```
yo angular translate
```

## Tools

### Internationalization

[angular-internationalization-tutorials](https://scotch.io/tutorials/internationalization-of-angularjs-applications)

[angular-translate-yeoman](https://github.com/malyw/angular-translate-yeoman/compare/yeoman-angular-clean...master)

### GitHub cards

[GitHub cards](https://lab.lepture.com/github-cards/#AlbanAndrieu/nabla-servers-bower-sample|default)

### TODO

TODO use https://angular-ui.github.io/bootstrap/ for language
TODO remvove app/styles/components/_header.scss language-select
TODO https://github.com/rackerlabs/angular-bootstrap-nav
SEE https://github.com/dlukez/angular-bootstrap-select/blob/master/angular-bootstrap-select.js
SEE https://github.com/angular-ui/angular-google-maps

## Quality tools

### python 3.6

Install python 3.6 and virtualenv

`virtualenv --no-site-packages /opt/ansible/env36 -p python3.6`
`source /opt/ansible/env36/bin/activate`
`pip install -r requirements-current-3.6.txt`

### pre-commit

See [pre-commit](http://pre-commit.com/)
Run `pre-commit install`
Run `pre-commit autoupdate`

First time run `cp hooks/* .git/hooks/` or `rm -Rf ./.git/hooks/ && ln -s ../hooks ./.git/hooks && git checkout hooks/`

Run `pre-commit run --all-files`

Commit `git commit -am 'TEST' --no-verify`

### takari maven wrapper

See [takari-maven-wrapper] (https://github.com/takari/maven-wrapper)

```
mvn -N io.takari:maven:wrapper
```

## NODE/NPM Installation

```
#npm cache clean -f
npm install -g n
#n stable
n 8.9.4
node -v
/usr/local/bin/node -v
npm install -g npm@5.5.1
env PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true npm install -g puppeteer@0.12.0
env PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true yarn global add puppeteer
```

## Installation

Install NPM modules.

```js
sudo npm install.
```

Install Javascript dependencies.

```js
bower install
```

## Build & development

Run `mvnw clean install` for building.
Run `grunt` for building and `grunt serve` for preview.
Run `mvnw site -Dskip.npm -Dskip.yarn -Dskip.bower -Dskip.grunt` for building site.

```
mvnw clean install -Dserver=jetty9x
#mvnw clean install -Dserver=jetty9x -Dskip.npm -Dskip.grunt -Dskip.bower -Dskip.yarn
mvnw verify gpg:sign -Dgpg.passphrase=thephrase 2>&1 sign.log
npm ls --licenses
```

Run `mvnw site -Dskip.npm -Dskip.yarn -Dskip.bower -Dskip.grunt` for building site.

as root
```
npm uninstall grunt-contrib-imagemin && npm install grunt-contrib-imagemin
```

## Documentation

See [mkdocs](https://www.mkdocs.org/)

Run `mkdocs` for building doc and `mkdocs serve` for preview.

```bash
mkdocs serve
mkdocs build
mkdocs gh-deploy
#mkdocs gh-deploy -b docs
```

[GitHub IO Documentation](http://albanandrieu.github.io/nabla-servers-bower-sample/)

## Fix imagemin upgrade

```
npm install optipng-bin@3.1.4
grunt imagemin:dist
```

## Testing

test (dev mode)
```
grunt serve watch -v
```

test (deployment mode)
```
grunt serve:dist
```

Running `grunt test` will run the unit tests with karma.

## Livereload

Run with grunt watch -v then manually edit a file listed in the watch.livereload.files array. Ensure that it is triggering the file by printing the file name to the console.

Then from the browser end, ensure going to http://localhost:35730/ works and displays {"tinylr":"Welcome","version":"0.2.1"} letting you know the live reload server is running.

Be sure the http://localhost:35730/livereload.js script is being loaded and you see the network socket being established.

## Proxy / Rewrite jetty

Proxy can be used to get access to oter URL.
In order to be activated it must be reached once : http://localhost:9090/login

Even though it is strongly advice to run this project behind an apache.
Please use : [ansible-web](https://github.com/AlbanAndrieu/ansible-web) in order to install this project behind an apache.

## Run war in jetty or using cargo

```
mvnw jetty:run-war
mvnw install org.codehaus.cargo:cargo-maven2-plugin:run -Dserver=jetty9x > install.log
```

## ZaProxy

Needed for having /usr/bin/xml2-config in the PATH

```
sudo apt-get install libxml2-dev libxslt-dev
```

Note that ZAProxy must be installed and zap.sh must be available on the executable path for this to work.
Make sure you are running zap 2.3.0 or 2.3.1

```
export PATH=/usr/local/zap/zap-2.3.0/:${PATH}
```

In case of trouble with zap locally.
Please deactivate html report in Gruntfile.js
html: false

Please use : [ansible-zaproxy](https://github.com/AlbanAndrieu/ansible-zaproxy) in order to install zaproxy

Start zap by hand:

```
sudo su - jenkins
export DISPLAY=:99 && nohup /usr/local/zap/zap-2.3.1/zap.sh -daemon -port 8090 > zap.log &
tail -f zap.log
```

## Selenium Grid

How to start selenium grid

```
#ssh -X root@home.nabla.mobi
sudo su - jenkins
#start by hand selenium grid
rm nohup.out
nohup java -jar /workspace/selenium-server-standalone-2.52.0.jar -Dwebdriver.chrome.driver=/usr/lib/chromium-browser/chromedriver -role hub -port 4444 -host 192.168.0.29 -debug &
tail -f nohup.out
#check hub is working
INFO - Nodes should register to http://172.17.42.1:4444/grid/register/
#start by hand selenium instance for home.nabla.mobi
ssh -X jenkins@home.nabla.mobi
#https://github.com/SeleniumHQ/selenium/wiki/Grid2
#export DISPLAY=localhost:99.0 && nohup java -jar /workspace/selenium-server-standalone-2.52.0.jar -role node -hub http://home.nabla.mobi:4444/wd/register -browser browserName=firefox,version=38.0,firefox_binary=/usr/bin/firefox,maxInstances=1,platform=LINUX -browser browserName=chrome,version=39.0.2171.95,chrome_binary=/opt/google/chrome/chrome,maxInstances=1,platform=LINUX &
#export DISPLAY=localhost:99.0 && nohup java -jar /workspace/selenium-server-standalone-2.52.0.jar -role node -hub http://127.0.0.1:4444/grid/register -browser browserName=firefox,version=40.0,firefox_binary=/usr/bin/firefox,maxInstances=1,platform=LINUX -browser browserName=chrome,version=43.0.2357.125,chrome_binary=/usr/bin/google-chrome,maxInstances=1,platform=LINUX clean install -Dserver=jetty9x -Dsurefire.useFile=false -Psample,jacoco,integration,run-its,arq-weld-ee-embedded -Darquillian=arq-weld-ee-embedded -Darquillian.launch=arq-weld-ee-embedded -Dwebdriver.chrome.driver=/usr/lib/chromium-browser/chromedriver -debug > selenum-hub.out 2>&1 &
#master
export DISPLAY=localhost:99.0 && nohup java -jar /workspace/selenium-server-standalone-2.53.0.jar -Dwebdriver.chrome.driver=/usr/lib/chromium-browser/chromedriver -role node -hub http://127.0.0.1:4444/grid/register -browser browserName=firefox,version=58.0.2,firefox_binary=/usr/bin/firefox,maxInstances=1,platform=LINUX -browser browserName=chrome,version=48.0.2564.116,chrome_binary=/usr/bin/google-chrome,maxInstances=1,platform=LINUX -debug > selenum-hub.out 2>&1 &
#ubuntu
export DISPLAY=localhost:99.0 && nohup java -jar /workspace/selenium-server-standalone-2.53.0.jar -Dwebdriver.chrome.driver=/usr/lib/chromium-browser/chromedriver -role node -hub http://192.168.0.29:4444/grid/register -host 192.168.0.18 -timeout 500 -maxSession 2 -browser browserName=firefox,version=51.0.1,firefox_binary=/usr/bin/firefox,maxInstances=3,platform=LINUX -browser browserName=chrome,version=50.0.2661.102,chrome_binary=/usr/bin/google-chrome,maxInstances=3,platform=LINUX -debug > selenum-hub.out 2>&1 &
#freenas
export DISPLAY=localhost:99.0 && nohup java -jar /workspace/selenium-server-standalone-2.53.0.jar -Dwebdriver.chrome.driver=/usr/lib/chromium-browser/chromedriver -role node -hub http://192.168.0.29:4444/grid/register -host 192.168.0.26 -timeout 500 -maxSession 2 -browser browserName=firefox,version=58.0,firefox_binary=/usr/local/bin/firefox,maxInstances=3,platform=LINUX -browser browserName=chrome,version=61.0.3163.100,chrome_binary=/usr/local/bin/chrome,maxInstances=3,platform=LINUX -debug > selenum-hub.out 2>&1 &
multitail nohup.out selenum-hub.out

curl http://localhost:4444/grid/api/proxy?id=http://172.17.42.1:5555
curl http://home.nabla.mobi:4444/grid/console

/usr/bin/google-chrome
/opt/google/chrome/chrome --> NOK

#On home.nabla.mobi check starter script at
#/etc/init.d/selenium_hub
```

Check result at :

curl http://home.nabla.mobi:4444/grid/console

http://home.nabla.mobi:4444/grid/console

http://192.168.0.29:5555/wd/hub/static/resource/hub.html

Please use : [ansible-selenium](https://github.com/AlbanAndrieu/ansible-selenium) in order to install selenium hub and node

## Jenkins

In order to properly configure Jenkins master

```
ADD /zapSource/build/zap in
sudo nano /etc/init/jenkins.conf
    export JENKINS_HOME
    export ZAPROXY_HOME=/zapSource/build/zap
    export PATH=$PATH:$ZAPROXY_HOME
```

## Screenshot

```
# First generate cookies file using protractor
grunt protractor
chmod 444 cookies.txt
rm ./target/test.png
phantomjs --debug=true --web-security=false --ignore-ssl-errors=true --cookies-file=./cookies.txt rasterize.js http://localhost:9090/ ./target/test.png
phantomjs --debug=true --web-security=false --ignore-ssl-errors=true --cookies-file=./cookies.txt netsniff.js http://localhost:9090/ > ./target/speed.har
#http://www.softwareishard.com/blog/har-viewer/
```

ls -lrta ~/.config/chromium/Default/Cookies
ls -lrta ~/.config/google-chrome/Default

## Yslow Psi WebPageTest

Run yslow, Psi or webpagetest

```
#grunt yslow_test
npm run pretest
phantomjs --ignore-ssl-errors=yes test/yslow.js --info basic --format plain http://localhost:9090/test/#/
grunt pagespeed
grunt wpt
```

## Deploy to internet

Page deployed at :

[GitHub IO](http://albanandrieu.github.io/nabla-servers-bower-sample/)

[GitHub gh-pages](http://htmlpreview.github.io/?https://github.com/AlbanAndrieu/nabla-servers-bower-sample/blob/gh-pages/index.html)

```
#VirtualHost *
sudo nano /etc/apache2/sites-available/awstats.conf
#VirtualHost *:7075
sudo nano /etc/apache2/sites-available/sample.conf
#Add the following
Alias /bower_components "/var/www/sample/bower_components"
Alias /fonts "/var/www/sample/fonts"
```

## Performance improvements

What has been done is described at https://www.youtube.com/watch?v=FEs2jgZBaQA

## Issues

[using-ui-bootstrap-causing-issues-with-carousel](http://stackoverflow.com/questions/26332202/using-ui-bootstrap-causing-issues-with-carousel)

In order to workaround issue of bower_components (cssmin) absolute path instead of releatif :
[how-to-avoid-grunt-build-not-loading-bootstrap-glyphicons-using-jhipster](http://ignaciosuay.com/how-to-avoid-grunt-build-not-loading-bootstrap-glyphicons-using-jhipster/)
[generator-angular](https://github.com/yeoman/generator-angular/issues/1011)

## Run End2End tests

```
mvnw clean install org.codehaus.cargo:cargo-maven2-plugin:run -Dserver=jetty9x
grunt --gruntfile Gruntfile-e2e.js
```

## Eclipse

 Uninstall Nodeclipse Core & Node.js

Add plugins

 - Groovy/Grails Tool Suite (GGTS) for Eclipse 3.6.4.RELEASE
 - Nodeclipse "Enide Studio 2014" is Tool Suite for Node.js
 - AngularJS Eclipse Plugin

### Import as Maven project

### Java

Project Properties | Java Build Path | Default output folder
Change target by target-eclipse
bower-sample/target-eclipse/classes

Exclude validation for

 - node
 - node_modules
 - bower_components
 - dist
 - app
 - coverage

### Javascript

WARNING : Javascript is not yet well supported in Eclipse

Project | Import as project "app"
Project Properties | JavasScript | Include Paths | Source | Add folders "script" "bower_components"

Based on the following sample : https://github.com/oasp/oasp4js

Project | Configure | Convert to AngularJS Project…
Project Properties | Resource | Link Resources |  ../bower_components
Project Properties | Tern | Script Paths | Add folder "app" -> JavaScript files and others available in project explorer
Project Properties | Resource | Resource Filters | Exclude | Exclude all | Name node_modules, Name dist -> fixes most Web Resource Problems

WARNING : Do not forget the / in order to be considered as a folder in bower_components/

Project Properties | Validation | Project specific settings | Web Resources Validator | Settings | Exclude Group | Folder: app/bower_components -> fixes "Undefined JavaScript file" in bower_components/
Project Properties | Validation | Project specific settings | HTML Angular Syntax Validator | Settings | Exclude Group | Folder: app/bower_components -> fixes "Undefined CSS class" in bower_components/

See https://github.com/oasp/oasp4js/issues/24 for more details

## Other resources

Yo generator :
https://github.com/peterhendrick/openSource

Thanks for reading!

# Contributing

The [issue tracker](https://github.com/AlbanAndrieu/nabla-servers-bower-sample/issues) is the preferred channel for bug reports, features requests and submitting pull requests.

For pull requests, editor preferences are available in the [editor config](.editorconfig) for easy use in common text editors. Read more and download plugins at <http://editorconfig.org>.

License
-------

[Apache v2](http://www.apache.org/licenses/LICENSE-2.0.html)

***

Alban Andrieu [linkedin](https://fr.linkedin.com/in/nabla/)
